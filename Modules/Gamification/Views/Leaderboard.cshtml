@model IEnumerable<TaskManager.Modules.Users.Models.ApplicationUser>

@{
    Layout = "_Layout";
    ViewData["Title"] = "CLASAMENT";

    // Sortăm utilizatorii după XP
    var sortedUsers = Model.OrderByDescending(u => u.TotalXp).ToList();

    // Helper pentru inițiale
    string GetInitials(string name)
    {
        if (string.IsNullOrEmpty(name)) return "U";
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        return parts.Length >= 2 ? $"{parts[0][0]}{parts[1][0]}".ToUpper() : parts[0].Substring(0, 1).ToUpper();
    }

    // Helper pentru clasa de rank (culori top 3 - DOAR PENTRU CULOAREA TEXTULUI)
    string GetRankClass(int index)
    {
        if (index == 0) return "rank-1"; // Gold
        if (index == 1) return "rank-2"; // Cyan/Silver
        if (index == 2) return "rank-3"; // Bronze
        return "";
    }
}

<div class="dashboard-wrapper fade-in">

    

    <main class="dashboard-main">

        <header class="hud-header-panel">
            <div>
                <h2 class="hud-welcome">CLASAMENT GENERAL</h2>
                <small>IERARHIE BAZATĂ PE EXPERIENȚĂ (XP)</small>
            </div>
            <div class="hud-date">
                <i class="bi bi-calendar-check me-2"></i>@DateTime.Now.ToString("dd.MM.yyyy")
            </div>
        </header>

        <div class="cyber-table-card">
            <div class="table-responsive">
                <table class="cyber-table">
                    <thead>
                        <tr>
                            <th class="text-center">RANK</th>
                            <th>UTILIZATOR</th>
                            <th class="text-center">NIVEL</th>
                            <th class="text-end">XP TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < sortedUsers.Count; i++)
                        {
                            var user = sortedUsers[i];
                            var rankClass = GetRankClass(i);

                            <tr class="@rankClass">
                                <td class="rank-cell">
                                    #@(i + 1)
                                </td>

                                <td>
                                    <div class="user-cell">
                                        <div class="table-avatar">
                                            @GetInitials(user.FullName)
                                        </div>
                                        <div>
                                            <div class="fw-bold text-white">@user.FullName</div>
                                            <div class="small text-white-50" style="font-size: 0.75rem;">Angajat</div>
                                        </div>
                                    </div>
                                </td>

                                <td class="text-center">
                                    <span class="badge bg-dark border border-secondary text-info rounded-pill px-3">
                                        LVL @(user.LevelId ?? 1)
                                    </span>
                                </td>

                                <td class="xp-cell">
                                    @user.TotalXp <span class="small text-muted">XP</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @if (!sortedUsers.Any())
            {
                <div class="text-center p-5 text-muted">
                    Nu există date în clasament.
                </div>
            }
        </div>

    </main>
</div>