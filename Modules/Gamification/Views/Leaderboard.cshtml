@model IEnumerable<TaskManager.Modules.Users.Models.ApplicationUser>

@{
    Layout = "_Layout";
    ViewData["Title"] = "CLASAMENT";

    // Sortăm utilizatorii după XP
    var sortedUsers = Model.OrderByDescending(u => u.TotalXp).ToList();

    // Helper pentru inițiale
    string GetInitials(string name)
    {
        if (string.IsNullOrEmpty(name)) return "U";
        var parts = name.Split(' ', StringSplitOptions.RemoveEmptyEntries);
        return parts.Length >= 2 ? $"{parts[0][0]}{parts[1][0]}".ToUpper() : parts[0].Substring(0, 1).ToUpper();
    }

    // Helper iconițe medalie (doar pt tabel)
    string GetRankIcon(int index)
    {
        if (index == 0) return "<i class='bi bi-trophy-fill'></i>";
        if (index == 1) return "<i class='bi bi-medal-fill'></i>";
        if (index == 2) return "<i class='bi bi-award-fill'></i>";
        return $"#{index + 1}";
    }

    // Helper clase culori
    string GetRankClass(int index)
    {
        if (index == 0) return "rank-1";
        if (index == 1) return "rank-2";
        if (index == 2) return "rank-3";
        return "";
    }
}

<div class="dashboard-wrapper fade-in">

   

    <main class="dashboard-main">

        <header class="hud-header-panel">
            <div>
                <h2 class="hud-welcome">CLASAMENT GENERAL</h2>
                <small>IERARHIE BAZATĂ PE EXPERIENȚĂ (XP)</small>
            </div>
            <div class="hud-date">
                <i class="bi bi-calendar-check me-2"></i>@DateTime.Now.ToString("dd.MM.yyyy")
            </div>
        </header>

        <div class="cyber-table-card">
            <div class="table-responsive">
                <table class="cyber-table">
                    <thead>
                        <tr>
                            <th class="text-center">RANK</th>
                            <th>UTILIZATOR</th>
                            <th class="text-center">NIVEL</th>
                            <th class="text-end">XP TOTAL</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (int i = 0; i < sortedUsers.Count; i++)
                        {
                            var user = sortedUsers[i];
                            var rankClass = GetRankClass(i);

                            <tr class="@rankClass">
                                <td class="rank-cell">
                                    @Html.Raw(GetRankIcon(i))
                                </td>

                                <td>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; border: 1px solid rgba(255,255,255,0.2);">
                                            @GetInitials(user.FullName)
                                        </div>
                                        <div>
                                            <div class="fw-bold text-white">@user.FullName</div>
                                            <div class="small text-white-50" style="font-size: 0.75rem;">Angajat</div>
                                        </div>
                                    </div>
                                </td>

                                <td class="text-center">
                                    <span class="badge bg-dark border border-secondary text-info rounded-pill px-3">
                                        LVL @(user.LevelId ?? 1)
                                    </span>
                                </td>

                                <td style="font-family: 'Courier New', monospace; font-weight: 700; color: var(--hud-green); text-align: right; font-size: 1.1rem;">
                                    @user.TotalXp <span class="small text-muted">XP</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

            @if (!sortedUsers.Any())
            {
                <div class="text-center p-5 text-muted">
                    Nu există date în clasament.
                </div>
            }
        </div>

    </main>
</div>