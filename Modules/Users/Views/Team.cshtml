@using TaskManager.Modules.Users.Models
@model IEnumerable<ApplicationUser>

@{
    ViewData["Title"] = "ECHIPA MEA";
    Layout = "~/Modules/Views/Shared/_Layout.cshtml";
}

<style>
    .team-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .team-card {
        background: rgba(15, 23, 42, 0.8);
        border: 1px solid rgba(6, 182, 212, 0.3); /* Cyan sters */
        border-radius: 12px;
        overflow: hidden;
        position: relative;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

        .team-card:hover {
            border-color: var(--hud-cyan);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.15);
            transform: translateY(-5px);
        }

        /* Linia decorativă de sus */
        .team-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--hud-cyan), transparent);
        }

    /* Avatar Hexagonal */
    .hex-avatar-container {
        width: 80px;
        height: 80px;
        margin: 0 auto;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .hex-avatar {
        width: 100%;
        height: 100%;
        background-color: rgba(6, 182, 212, 0.1);
        clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid rgba(6, 182, 212, 0.5); /* Contur */
        color: var(--hud-cyan);
        font-family: 'Courier New', monospace;
        font-size: 1.8rem;
        font-weight: bold;
        text-shadow: 0 0 10px rgba(6, 182, 212, 0.8);
    }

    .role-badge {
        font-size: 0.7rem;
        letter-spacing: 1px;
        padding: 4px 12px;
        border-radius: 20px;
        border: 1px solid;
    }

    .contact-row {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 8px;
        margin-top: 15px;
    }
</style>

<div class="fade-in pt-4">

    <header class="hud-header-panel mb-4 mt-4">
        <div>
            <h2 class="hud-welcome">ECHIPA MEA</h2>
            <small>MEMBRII DEPARTAMENTULUI ȘI STATUSUL LOR</small>
        </div>
        <div class="d-flex align-items-center gap-2">
            <span class="badge bg-dark border border-info text-info font-monospace p-2">
                <i class="bi bi-people-fill me-2"></i>TOTAL: @Model.Count()
            </span>
        </div>
    </header>

    <div class="team-grid">
        @foreach (var user in Model)
        {
            // Calcul Initiale
            string initials = "U";
            string fullName = "Unknown";

            if (!string.IsNullOrEmpty(user.FirstName) && !string.IsNullOrEmpty(user.LastName))
            {
                initials = user.FirstName.Substring(0, 1) + user.LastName.Substring(0, 1);
                fullName = $"{user.FirstName} {user.LastName}";
            }
            else
            {
                // Fallback dacă nu are nume setat
                initials = (!string.IsNullOrEmpty(user.Email) && user.Email.Length >= 2)
                ? user.Email.Substring(0, 2).ToUpper()
                : "US";
                fullName = user.Email ?? "No Email";
            }

            // Deoarece ApplicationUser nu are proprietatea 'Role' direct,
            // și controllerul filtrează doar rolul 'User', presupunem că sunt Useri.
            string roleColor = "border-info text-info";
            string roleIcon = "bi-person";
            string roleName = "TEAM MEMBER";

            <div class="team-card p-4">

                <div class="text-center mb-3">
                    <div class="hex-avatar-container mb-3">
                        <div class="hex-avatar">
                            @initials.ToUpper()
                        </div>
                    </div>

                    <h5 class="text-white font-monospace fw-bold mb-1">@fullName</h5>

                    <div class="d-flex justify-content-center gap-2 mt-2">
                        <span class="role-badge @roleColor font-monospace">
                            <i class="bi @roleIcon me-1"></i> @roleName
                        </span>
                        @if (user.LevelId.HasValue)
                        {
                            <span class="role-badge border-warning text-warning font-monospace" title="Nivel Curent">
                                <i class="bi bi-star-fill me-1"></i> LVL @user.LevelId
                            </span>
                        }
                    </div>
                </div>

                <div class="contact-row d-flex align-items-center justify-content-between mb-3">
                    <div class="text-truncate w-100 text-center">
                        <small class="text-muted d-block font-monospace" style="font-size: 0.65rem;">EMAIL CORPORATIV</small>
                        <span class="text-white-50 small font-monospace text-truncate d-block" title="@user.Email">
                            @user.Email
                        </span>
                    </div>
                </div>

                <div class="d-grid gap-2">
                    <a href="mailto:@user.Email" class="btn btn-sm btn-outline-secondary font-monospace border-secondary text-white-50">
                        <i class="bi bi-envelope me-2"></i>TRIMITE EMAIL
                    </a>

                    <a asp-controller="Tasks" asp-action="Assign" class="btn btn-sm btn-tech fw-bold font-monospace">
                        <i class="bi bi-list-task me-2"></i>ALOCĂ TASK
                    </a>
                </div>

            </div>
        }
    </div>

    @if (!Model.Any())
    {
        <div class="text-center py-5">
            <div class="text-secondary mb-3 opacity-50"><i class="bi bi-people fa-4x"></i></div>
            <h6 class="text-secondary font-monospace">NU EXISTĂ MEMBRI ÎN ECHIPĂ.</h6>
        </div>
    }

</div>